<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="./dist/aframe-street-component.js"></script>
    <script src="https://unpkg.com/aframe-presentation-component/dist/aframe-presentation-component.min.js"></script>
    <script src="https://raw.githack.com/dbradleyfl/aframe-gridhelper/master/dist/aframe-gridhelper-component.min.js"></script> 

    <!-- ocean, ground, sky -->
    <script src="src/components/ocean-plane.js"></script>
    <script src="src/lib/aframe-cubemap-component.js"></script>
    <script>
      AFRAME.registerComponent('forward', {
        schema: {
          speed: {default: 0.1},
        },

        init: function() {
          var worldDirection = new THREE.Vector3();

          this.el.object3D.getWorldDirection(worldDirection);
    //          worldDirection.multiplyScalar(-1);

            this.worldDirection = worldDirection;
            console.log(this.worldDirection);
          },

          tick: function() {
            var el = this.el;

            var currentPosition = el.getAttribute('position');
            var newPosition = this.worldDirection
                              .clone()
                              .multiplyScalar(this.data.speed)
                              .add(currentPosition);
            el.setAttribute('position', newPosition);
          }
        });
      </script>
      <script>
        AFRAME.registerComponent('timed-inspector', {
          init: function() {
            this.data // seconds
            setTimeout( function () {
              window.postMessage('INJECT_AFRAME_INSPECTOR')
            }, this.data * 1000)
          }
        });
      </script>
    <!-- 2d ui toolbar -->
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    -->

    <!-- move a-frame performance `stats` below toolbar -->
    <style>
      .rs-base {
        left: 20px;
        top: 80px;
      }

      body {
        background-color: gray;
      }

      div#aframe-presentation-progress-bar {
        background-color: rgb(201, 0, 201) !important;
      }
    </style>

  </head>
  <body>
    <a-scene 
    renderer="colorManagement: true; highRefreshRate: true; foveationLevel: 3; physicallyCorrectLights: true; logarithmicDepthBuffer: false;"
    fogoff="type: linear; color: #D5C69B; far: 200"
    gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/v1/decoders/;"
    gridhelper="size:1000;divisions:50;colorGrid:#c900c9;colorCenterLine:#c900c9;"
    background="color: black">
      <a-assets>
        <streetmix-assets url="./"></streetmix-assets>

        <a-cubemap id="skycube">
          <img src="assets/images/skybox/posx.jpg">
          <img src="assets/images/skybox/negx.jpg">
          <img src="assets/images/skybox/posy.jpg">
          <img src="assets/images/skybox/negy.jpg">
          <img src="assets/images/skybox/posz.jpg">
          <img src="assets/images/skybox/negz.jpg">
        </a-cubemap>

        <img
          id="grass-texture"
          src="assets/materials/TexturesCom_Grass0052_1_seamless_S.jpg"
        />
        <img
          id="markings-atlas"
          src="assets/materials/lane-markings-atlas_1024.png"
          crossorigin="anonymous"
        />
        <img
          id="sidewalk-texture"
          src="assets/materials/TexturesCom_FloorsRegular0301_1_seamless_S.jpg"
          crossorigin="anonymous"
        />
        <img
          id="drive-lane-texture"
          src="assets/materials/TexturesCom_Roads0086_1_seamless_S_rotate.jpg"
          crossorigin="anonymous"
        />
      </a-assets>
      <a-presentation disable-aspect-ratio="16:9" use-hash="false">
        <a-slide>
          <a-slide-camera position="0 500 0" rotation="-90 0 90"></a-slide-camera>
          <!-- <a-slide-animation selector="#camera" animations="zoomin"></a-slide-animation> -->
          <a-slide-visibility selector="#labelParent1" visibility="true"></a-slide-visibility>
        </a-slide>
        <a-slide>
          <a-slide-animation selector="#camera" animations="zoomout"></a-slide-animation>
          <a-slide-camera position="0 30 0" rotation="-90 0 0" duration="100"></a-slide-camera>
          <a-slide-visibility selector="#labelParent2" visibility="true"></a-slide-visibility>

        </a-slide>
        <a-slide>
          <a-slide-camera position="0 10 25" rotation="-30 0 0" ></a-slide-camera>
        </a-slide>
        <a-slide>
          <a-slide-camera position="0 0 500" rotation="0 0 0" duration="100"></a-slide-camera>
          <a-slide-animation selector="#camera" animations="zoominfast"></a-slide-animation>

        </a-slide>
      </a-presentation>
      <a-entity id="cameraRig" position="0 0 -120">
        <a-entity id="camera" camera="far: 1000; zoom: 15" wasd-controls="enabled: false"></a-entity>
        <a-entity id="leftHand" hand-controls="hand: left; handModelStyle: lowPoly; color: #ccffcc" teleport-controls="cameraRig: #cameraRig; button: trigger"></a-entity>
        <a-entity id="rightHand" hand-controls="hand: right; handModelStyle: lowPoly; color: #ccffcc" teleport-controls="cameraRig: #cameraRig; button: trigger"></a-entity>
      </a-entity>

      <a-entity light="type: ambient; color: #FFF; intensity: 2"></a-entity>
      <a-entity light="type: directional; color: #FFF; intensity: 0.6; castShadow:true;" position="0.5 1 -1"></a-entity>

      <a-ocean-plane visible="false" height="100" width="100" position="0 -10 0" material="envMap: #skycube;"></a-ocean-plane>

      <a-entity id="skybox" cubemap="folder: assets/images/skybox/"
      animation="property: visible; from: false; to: true; dur: 3000;"
      ></a-entity>

      <a-entity id="main">
        <!--馬路 由左至右-->
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-4.6 0 1"
          vertex-b="-5.1 0 -38"
          vertex-c="0 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-5.1 0 -38"
          vertex-b="-1.5 0 -38"
          vertex-c="0 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="0 0 1"
          vertex-b="-1.5 0 -38"
          vertex-c="2.25 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-1.5 0 -38"
          vertex-b="1.5 0 -38"
          vertex-c="2.25 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="2.25 0 1"
          vertex-b="4.6 0 1"
          vertex-c="1.5 0 -38"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="1.5 0 -38"
          vertex-b="5.1 0 -38"
          vertex-c="4.6 0 1"
        ></a-triangle>
        <!--馬路結束-->

        <!--人行道 由左至右-->
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="-7.6 0 1"
          vertex-b="-7.6 0 -38"
          vertex-c="-4.6 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="-7.6 0 -38"
          vertex-b="-5.1 0 -38"
          vertex-c="-4.6 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="4.6 0 1"
          vertex-b="5.1 0 -38"
          vertex-c="7.6 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="5.1 0 -38"
          vertex-b="7.6 0 -38"
          vertex-c="7.6 0 1"
        ></a-triangle>
        <!--人行道結束-->

        <!--漸變帶兩邊地板-->
        <a-entity
          position="0 -10 -249"
          rotation="-90 0 0"
          geometry="primitive:plane;height:350;width:350"
          material="src:#grass-texture;repeat:5 5;roughness:1"
        ></a-entity>

        <!--雙黃線-->
        <a-entity
          position="-0.75 0.01 -87"
          rotation="-90 0 3.576"
          atlas-uvs="totalColumns: 4; column: 3"
          scale="1 1 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 25;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.5; height:24;"
        ></a-entity>
        <a-entity
          position="-1.5 0.01 -106.4"
          rotation="-90 0 0"
          atlas-uvs="totalColumns: 4; column: 3"
          scale="1 0.62 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 25;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.5; height:24;"
        ></a-entity>

        <!--馬路虛線-->
        <a-entity
          position="2 0.01 -87"
          rotation="-90 0 1.79"
          atlas-uvs="totalRows: 1; totalColumns: 8; row: 1; column: 4"
          scale="1 1 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 4;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.20; height:24;"
        ></a-entity>

        <a-entity
        position="1.63 0.01 -106.4"
        rotation="-90 0 0"
        atlas-uvs="totalColumns: 8; column: 4"
        scale="1 1 1"
        material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 2.5;"
        geometry="primitive: plane; buffer: false; skipCache: true; width:0.2; height:14"
      ></a-entity>

        <a-entity
          id="street-parent"
          street='left: grass; right: grass; JSON:
        {
          "streetmixSegmentsFeet": [
          {"width":10,"type":"sidewalk","variantString":"dense"},
          {"width":15,"type":"drive-lane","variantString":"inbound|car"},
          {"width":15,"type":"drive-lane","variantString":"outbound|car"},
          {"width":10,"type":"sidewalk","variantString":"dense"}
          ]
        }'
        ></a-entity>
      </a-entity>

      <a-entity position="0 0 -237.2" rotation="0 180 0">
        <!--馬路 由左至右-->
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-4.6 0 1"
          vertex-b="-5.1 0 -38"
          vertex-c="0 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-5.1 0 -38"
          vertex-b="-1.5 0 -38"
          vertex-c="0 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="0 0 1"
          vertex-b="-1.5 0 -38"
          vertex-c="2.25 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="-1.5 0 -38"
          vertex-b="1.5 0 -38"
          vertex-c="2.25 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="2.25 0 1"
          vertex-b="4.6 0 1"
          vertex-c="1.5 0 -38"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:0.3 1;offset:0.55 0"
          src="#drive-lane-texture"
          vertex-a="1.5 0 -38"
          vertex-b="5.1 0 -38"
          vertex-c="4.6 0 1"
        ></a-triangle>
        <!--馬路結束-->

        <!--人行道 由左至右-->
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="-7.6 0 1"
          vertex-b="-7.6 0 -38"
          vertex-c="-4.6 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="-7.6 0 -38"
          vertex-b="-5.1 0 -38"
          vertex-c="-4.6 0 1"
        ></a-triangle>

        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="4.6 0 1"
          vertex-b="5.1 0 -38"
          vertex-c="7.6 0 1"
        ></a-triangle>
        <a-triangle
          position="0 0 -76"
          material="side:double;repeat:1.5 15;offset:0.55 0"
          src="#sidewalk-texture"
          vertex-a="5.1 0 -38"
          vertex-b="7.6 0 -38"
          vertex-c="7.6 0 1"
        ></a-triangle>
        <!--人行道結束-->

        <!--雙黃線-->
        <a-entity
          position="-0.75 0.01 -87"
          rotation="-90 0 3.576"
          atlas-uvs="totalColumns: 4; column: 3"
          scale="1 1 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 25;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.5; height:24;"
        ></a-entity>
        <a-entity
          position="-1.5 0.01 -106.4"
          rotation="-90 0 0"
          atlas-uvs="totalColumns: 4; column: 3"
          scale="1 0.62 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 25;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.5; height:24;"
        ></a-entity>

        <!--馬路虛線-->
        <a-entity
          position="2 0.01 -87"
          rotation="-90 0 1.79"
          atlas-uvs="totalRows: 1; totalColumns: 8; row: 1; column: 4"
          scale="1 1 1"
          material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 4;"
          geometry="primitive: plane; buffer: false; skipCache: true; width:0.20; height:24;"
        ></a-entity>

        <a-entity
        position="1.63 0.01 -106.4"
        rotation="-90 0 0"
        atlas-uvs="totalColumns: 8; column: 4"
        scale="1 1 1"
        material="src: #markings-atlas;alphaTest: 0;transparent:true;repeat:1 2.5;"
        geometry="primitive: plane; buffer: false; skipCache: true; width:0.2; height:14"
      ></a-entity>

        <a-entity
          id="street-parent"
          street='left: grass; right: grass; JSON:
        {
          "streetmixSegmentsFeet": [
          {"width":10,"type":"sidewalk","variantString":"dense"},
          {"width":15,"type":"drive-lane","variantString":"inbound|car"},
          {"width":15,"type":"drive-lane","variantString":"outbound|car"},
          {"width":10,"type":"sidewalk","variantString":"dense"}
          ]
        }'
        ></a-entity>
      </a-entity>

      <!--不重要道路(上下)-->
      <a-entity id="unimportant" position="0 -0.1 -118.6">
        <a-entity
          position="-82.5 0 0"
          rotation="0 90 0"
          id="street-parent"
          street='showGround: false; left: grass; right: grass; JSON:
        {
          "streetmixSegmentsFeet": [
          {"width":10,"type":"sidewalk","variantString":"dense"},
          {"width":15,"type":"drive-lane","variantString":"inbound|car"},
          {"width":15,"type":"drive-lane","variantString":"outbound|car"},
          {"width":10,"type":"sidewalk","variantString":"dense"}
          ]
        }'
        ></a-entity>

        <a-entity
          position="82.5 0 0"
          rotation="0 90 0"
          id="street-parent"
          street='showGround: false; left: grass; right: grass; JSON:
        {
          "streetmixSegmentsFeet": [
          {"width":10,"type":"sidewalk","variantString":"dense"},
          {"width":15,"type":"drive-lane","variantString":"inbound|car"},
          {"width":15,"type":"drive-lane","variantString":"outbound|car"},
          {"width":10,"type":"sidewalk","variantString":"dense"}
          ]
        }'
        ></a-entity>

        <a-plane position="0 0 0" rotation="-90 0 0" width="15.1" height="9.2" color="#545f59"></a-plane>

      </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
